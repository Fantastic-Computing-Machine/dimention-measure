{% extends 'base.html' %}

{% block head %}
<title>Expenses {{projectName | capitalize}}</title>
{% endblock %}

{% block header %}

<!-- Add new user modal trigger -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#userModal">
    <img src="https://img.icons8.com/ios/30/ffffff/user--v3.png" />
</button>
<!-- Add new user modal trigger -->

{% block expense_header %}
<!-- Add new Expense modal trigger -->
<button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
    <img src="https://img.icons8.com/ios/30/ffffff/money.png" />
</button>
<!-- Add new Expense modal trigger -->
{% endblock %}

{% endblock %}


{% block body %}

<!-- Add new user modal trigger -->
<div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <form action="" method="POST" id="userModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="userModalLabel">New Payee</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <input type="text" class="form-control my-2" id="newPayeeName" name="newPayeeName" ,
                        aria-label="Recipient's username" aria-describedby="button-addon2" placeholder="Payee name">

                    <div class="mb-3">
                        <textarea class="form-control my-2" id="exampleFormControlTextarea1" name="remarks" rows="3"
                            placeholder="remarks (optional)"></textarea>
                    </div>

                    <div class="text-center">
                        <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapseExample" role="button"
                            aria-expanded="false" aria-controls="collapseExample">Show Payee</a>
                        <button class="btn btn-success" type="submit" name="userModal" value="userModal" id="userModal"
                            id="button-addon2">Add</button>
                    </div>

                    <div class="my-2">
                        <div class="collapse my-2" id="collapseExample">
                            <ul class="list-group">
                                {% for item in payee_list %}
                                <li class="list-group-item">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <b>{{item.get('payeeName')}}</b>

                                            {% if item.get('remarks')!=None %}
                                            : {{item.get('remarks')}}
                                            {% endif %}
                                        </div>
                                        <div>
                                            <span class="align-items-start">
                                                <a class="btn btn-light"
                                                    href="{{ url_for('expense_urls.payee_update', payee_id=item.get('payeeId')) }}">
                                                    <img src="https://img.icons8.com/ios/20/000000/edit--v2.png" />
                                                </a>
                                                <a class="btn btn-light"
                                                    href="{{ url_for('expense_urls.payee_delete', payee_id=item.get('payeeId')) }}">
                                                    <img
                                                        src="https://img.icons8.com/ios/20/000000/delete-forever.png" />
                                                </a>
                                            </span>
                                        </div>
                                    </div>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>

                </div>
            </div>
        </form>
    </div>
</div>
<!-- Add new user modal trigger -->

<!-- Add new Expense modal -->

<div class="modal fade" id="staticBackdrop" tabindex="-1" aria-labelledby="expenseModalLabel" width="75%"
    aria-hidden="true">
    <div class="modal-dialog">
        <form action="" method="POST" id="expense">
            <div class="mx-auto">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">Add Expense</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body">
                        <div class="my-3 mx-4">
                            <select class="form-select" name="payee_list" aria-label="Default select example">
                                <option selected>Select Payee</option>
                                {% for item in payee_list %}
                                <option value="{{item.get('payeeName')}}">{{item.get('payeeName')}}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="my-3 mx-4">
                            <div class="form-floating">
                                <input type="number" step=".01" class="form-control" id="amount" name="amount">
                                <label for="newPayeeName">Amount</label>
                            </div>
                        </div>
                        <div class="my-3 mx-4">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="status_radio" id="paidRadio"
                                    value="Paid">
                                <label class="badge bg-danger rounded-pill" for="paidRadio">Paid</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="status_radio" id="recievedradio"
                                    value="Recieved">
                                <label class="badge bg-success rounded-pill" for="recievedradio">Recieved</label>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" name="expenseModal" value="expenseModal" id="expenseModal"
                            class="btn btn-success">Save</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
<!-- Add new Expense modal -->


<div class="container px-3">
    <div class="text-light py-2 display-4">{{projectName | capitalize}} Expenses</div>

    <div class="row flex-md-row-reverse py-3" dir="rtl">
        <div class="col-md-6 col_height">
            <!-- SUM CARD -->
            <div class="order-md-2 card my-2">
                <div class="card-body">
                    <ul class="list-group">
                        <h5>
                            <li class="list-group-item d-flex justify-content-between list-group-item-danger">
                                Sum Paid
                                <span class="badge font-monospace bg-danger">₹ {{'%0.2f' |
                                    format(sum_result[0].get('sum_paid') | float) }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between list-group-item-success">
                                Sum Recieved
                                <span class="badge font-monospace bg-success">₹ {{'%0.2f' |
                                    format(sum_result[0].get('sum_recieved') | float) }}</span>
                            </li>
                        </h5>
                    </ul>
                </div>
            </div>
            <!-- SUM CARD -->
            <!-- TOTAL TRANSACTIONS -->
            <div class="order-md-1 card my-2">
                <div class="card-body">
                    <h4>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Total Transactions:
                            <span class="badge font-monospace bg-primary"># {{expense_list|length}}</span>
                        </li>
                    </h4>
                </div>
            </div>
            <!-- TOTAL TRANSACTIONS -->
            <!-- PAYEES CARD -->
            <div class="order-md-4 card my-2">
                <div class="card-body payee_card">
                    <p class="fs-4">Payees</p>
                    {% if payee_list|length == 0 %}
                    <div class=" text-center my-3">
                        <img class="img-fluid m-2" style="width: 300px;"
                            src="{{ url_for('static', filename='img/blank.svg') }}">
                        <div class="text-center">
                            <p class="py-1 fw-light my-3 fs-1">Nothing Here
                                <button type="button" class="btn btn-outline-success" data-bs-toggle="modal"
                                    data-bs-target="#userModal">
                                    Add Payee
                                </button>
                            </p>
                        </div>
                    </div>
                    {% endif %}
                    <ul class="list-group">
                        {% for item in payee_list %}
                        <li class="list-group-item">

                            <div class="d-flex justify-content-between">
                                <div calss="fw-bold">
                                    <a href="{{ url_for('expense_urls.payee_expense', payee=item.get('payeeName'))}}"
                                        style="text-decoration: none;">
                                        <div class="fw-bold">{{item.get('payeeName')| capitalize}}</div>
                                    </a>
                                    {% if item.get('remarks')==None %}
                                    No Remarks
                                    {% else %}
                                    {{item.get('remarks')|capitalize}}
                                    {% endif %}
                                </div>
                                <div>
                                    <span class="align-items-start">
                                        <a class="btn btn-light"
                                            href="{{ url_for('expense_urls.payee_update', payee_id=item.get('payeeId')) }}">
                                            <img src="https://img.icons8.com/ios/20/000000/edit--v2.png" />
                                        </a>
                                        <a class="btn btn-light"
                                            href="{{ url_for('expense_urls.payee_project_delete',projectName=projectName, pid=pid, payee_id=item.get('payeeId')) }}">
                                            <img src="https://img.icons8.com/ios/20/000000/delete-forever.png" />
                                        </a>
                                    </span>
                                </div>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <!-- PAYEES CARD -->
        </div>

        <!-- EXPENSE LIST CARD  -->
        <div class="col-md-6 col_height">
            <div class="order-md-3 card my-2">
                <div class="card-body scroll_card_expense">
                    <p class="fs-4">Expenses</p>
                    {% if expense_list|length == 0 %}
                    <div class=" text-center my-3">
                        <img class="img-fluid m-2" style="width: 450px;"
                            src="{{ url_for('static', filename='img/void.svg') }}">
                        <div class="text-center">
                            <p class="py-1 fw-light my-3 fs-1">Nothing Here
                                <button type="button" class="btn btn-outline-success mx-1" data-bs-toggle="modal"
                                    data-bs-target="#staticBackdrop">
                                    Add Expense
                                </button>
                            </p>
                        </div>
                    </div>
                    {% endif %}

                    <ol class="list-group list-group-numbered">
                        {% for item in expense_list %}
                        <!-- EXPENSE LIST -->
                        <li class="list-group-item d-flex justify-content-between align-items-start"
                            data-bs-toggle="modal" data-bs-target="#{{item.get('payee')}}{{item.get('expId')}}">
                            <div class="ms-2 me-auto">
                                <div class="fw-bold">{{item.get('payee') | capitalize}}</div>
                                <span class="badge bg-secondary">
                                    {{item.get('date_created').date().strftime('%b %d, %Y')}}</span>
                            </div>
                            <h4>
                                {% if item.get('payment_status')=='Paid' %}
                                <span class="badge bg-danger font-monospace">
                                    ₹ {{'%0.2f' | format(item.get('amount') | float)}}</span>
                                {% else %}
                                <span class="badge bg-success font-monospace">
                                    ₹ {{'%0.2f' | format(item.get('amount') | float)}}</span>
                                {% endif %}
                            </h4>
                        </li>
                        <!-- EXPENSE LIST -->

                        <!-- UPDATE EXPENSE MODAL -->
                        <div class="modal fade" id="{{item.get('payee')}}{{item.get('expId')}}" tabindex="-1"
                            aria-labelledby="{{item.get('payee')}}{{item.get('expId')}}Label" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <!-- UPDATE EXPENSE MODAL HEADER -->
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="{{item.get('payee')}}{{item.get('expId')}}Label">
                                            Update {{item.get('payee') | capitalize}}</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <!-- UPDATE EXPENSE MODAL HEADER -->

                                    <form action="" method="POST" id="expense_update">
                                        <!-- UPDATE EXPENSE MODAL BODY -->
                                        <div class="modal-body">
                                            <div class="my-3 mx-4">

                                                <input class="form-control" name="payee_list" type="text"
                                                    value="{{item.get('payee')}}" readonly>
                                            </div>
                                            <div class="my-3 mx-4">
                                                <div class="form-floating">
                                                    <input type="number" step=".01" class="form-control" id="amount"
                                                        value="{{item.get('amount')}}" name="amount">
                                                    <label for="newPayeeName">Amount</label>
                                                </div>
                                            </div>
                                            <div>
                                                <input class="form-control" type="text" name='expId' id='expId'
                                                    value="{{item.get('expId')}}" hidden />
                                            </div>
                                        </div>
                                        <!-- UPDATE EXPENSE MODAL BODY -->

                                        <!-- UPDATE EXPENSE MODAL FOOTER -->
                                        <div class="modal-footer">
                                            <a type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</a>
                                            <button type="submit" class="btn btn-primary" name="expense_update"
                                                value="expense_update" id="expense_update">Save
                                                changes</button>
                                            <a class="btn btn-danger"
                                                href="{{ url_for('expense_urls.expense_project_delete',pid=pid, projectName=projectName, expId=item.get('expId')) }}">Delete</a>
                                        </div>
                                        <!-- UPDATE EXPENSE MODAL FOOTER -->
                                    </form>
                                </div>
                            </div>
                        </div>
                        <!-- EXPENSE MODAL -->
                        {% endfor %}
                    </ol>
                </div>
            </div>
        </div>
        <!-- EXPENSE LIST CARD  -->
    </div>
</div>

{% endblock %}

{% block expense_button %}
{% if pid %}
<a href="{{ url_for('record', projectName=projectName, pid=pid )}}" type="button" class="btn btn-success btn-lg">
    <img src="https://img.icons8.com/ios/30/ffffff/safety-hat.png" />
</a>
{% else %}
<a href="{{ url_for('index')}}" type="button" class="btn btn-success btn-lg">
    <img src="https://img.icons8.com/ios/30/ffffff/safety-hat.png" />
</a>
{% endif %}
{% endblock %}